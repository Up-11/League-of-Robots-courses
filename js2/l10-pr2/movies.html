<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>–ö–∏–Ω–æ—Ç–µ–∫–∞ - –í—Å–µ —Ñ–∏–ª—å–º—ã</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
				background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
				color: #fff;
				min-height: 100vh;
			}

			.container {
				max-width: 1200px;
				margin: 0 auto;
				padding: 20px;
			}

			.header {
				text-align: center;
				margin-bottom: 40px;
				padding: 30px 0;
				background: rgba(255, 255, 255, 0.05);
				border-radius: 15px;
			}

			.header h1 {
				font-size: 3em;
				background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
				-webkit-background-clip: text;
				-webkit-text-fill-color: transparent;
				margin-bottom: 10px;
			}

			.nav {
				display: flex;
				justify-content: center;
				gap: 20px;
				margin-bottom: 30px;
				flex-wrap: wrap;
			}

			.nav-btn {
				padding: 12px 25px;
				background: rgba(255, 255, 255, 0.1);
				border: none;
				border-radius: 25px;
				color: white;
				cursor: pointer;
				transition: all 0.3s ease;
				font-size: 16px;
				text-decoration: none;
			}

			.nav-btn:hover {
				background: rgba(255, 255, 255, 0.2);
				transform: translateY(-2px);
			}

			.movies-grid {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
				gap: 25px;
			}

			.movie-card {
				background: rgba(255, 255, 255, 0.05);
				border-radius: 15px;
				overflow: hidden;
				transition: all 0.3s ease;
				border: 1px solid rgba(255, 255, 255, 0.1);
			}

			.movie-card:hover {
				transform: translateY(-10px);
				box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
				border-color: #4ecdc4;
			}

			.movie-poster {
				width: 100%;
				height: 400px;
				background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 3em;
				color: white;
			}

			.movie-info {
				padding: 20px;
			}

			.movie-title {
				font-size: 1.3em;
				font-weight: bold;
				margin-bottom: 10px;
				color: #fff;
			}

			.movie-meta {
				display: flex;
				justify-content: space-between;
				margin-bottom: 10px;
				font-size: 0.9em;
				color: #ccc;
			}

			.movie-rating {
				color: #ffd700;
				font-weight: bold;
			}

			.movie-description {
				color: #aaa;
				font-size: 0.9em;
				line-height: 1.4;
				margin-bottom: 15px;
			}

			.movie-actions {
				display: flex;
				gap: 10px;
			}

			.btn {
				padding: 8px 15px;
				border: none;
				border-radius: 5px;
				cursor: pointer;
				transition: all 0.3s ease;
				font-size: 14px;
			}

			.btn-primary {
				background: #4ecdc4;
				color: white;
			}

			.btn-danger {
				background: #ff6b6b;
				color: white;
			}

			.btn:hover {
				transform: translateY(-2px);
				box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
			}

			.loading {
				text-align: center;
				padding: 40px;
				color: #ccc;
				font-size: 1.1em;
				grid-column: 1 / -1;
			}

			.status-badge {
				display: inline-block;
				padding: 4px 12px;
				border-radius: 15px;
				font-size: 0.8em;
				font-weight: bold;
				margin-bottom: 10px;
			}

			.status-watched {
				background: rgba(78, 205, 196, 0.2);
				color: #4ecdc4;
				border: 1px solid #4ecdc4;
			}

			.status-towatch {
				background: rgba(255, 107, 107, 0.2);
				color: #ff6b6b;
				border: 1px solid #ff6b6b;
			}

			.message {
				padding: 15px;
				margin-bottom: 20px;
				border-radius: 8px;
				text-align: center;
			}

			.error {
				background: rgba(255, 107, 107, 0.2);
				border: 1px solid #ff6b6b;
				color: #ff6b6b;
			}

			.success {
				background: rgba(78, 205, 196, 0.2);
				border: 1px solid #4ecdc4;
				color: #4ecdc4;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="header">
				<h1>üé¨ –ö–∏–Ω–æ—Ç–µ–∫–∞</h1>
				<p>–í–∞—à–∞ –∫–æ–ª–ª–µ–∫—Ü–∏—è —Ñ–∏–ª—å–º–æ–≤</p>
			</div>

			<div class="nav">
				<a href="index.html" class="nav-btn">üè† –ì–ª–∞–≤–Ω–∞—è</a>
				<a href="movies.html" class="nav-btn">üé• –í—Å–µ —Ñ–∏–ª—å–º—ã</a>
				<a href="add-movie.html" class="nav-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º</a>
			</div>

			<div id="message"></div>

			<div id="movies-container" class="movies-grid">
				<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–ª—å–º–æ–≤...</div>
			</div>
		</div>

		<script>
			const API_URL = 'https://0594c48b9b34d094.mokky.dev/movies'
			let movies = []

			document.addEventListener('DOMContentLoaded', function () {
				loadMovies()
			})

			async function loadMovies() {
				try {
					const response = await fetch(API_URL)
					if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∏–ª—å–º–æ–≤')
					movies = await response.json()
					renderMovies()
				} catch (error) {
					showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∏–ª—å–º–æ–≤: ' + error.message, 'error')
				}
			}

			async function toggleWatchStatus(movieId) {
				const movie = movies.find(m => m.id === movieId)
				if (!movie) return

				const newStatus = movie.status === 'watched' ? 'towatch' : 'watched'

				try {
					const response = await fetch(`${API_URL}/${movieId}`, {
						method: 'PATCH',
						headers: {
							'Content-Type': 'application/json',
						},
						body: JSON.stringify({ status: newStatus }),
					})

					if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞')

					showMessage(
						`–°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω: ${
							newStatus === 'watched' ? '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ' : '–ö –ø—Ä–æ—Å–º–æ—Ç—Ä—É'
						}`,
						'success'
					)
					await loadMovies()
				} catch (error) {
					showMessage(
						'–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞: ' + error.message,
						'error'
					)
				}
			}

			async function deleteMovie(movieId) {
				if (
					!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∏–ª—å–º –∏–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏?')
				) {
					return
				}

				try {
					const response = await fetch(`${API_URL}/${movieId}`, {
						method: 'DELETE',
					})

					if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∏–ª—å–º–∞')

					showMessage('–§–∏–ª—å–º —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω!', 'success')
					await loadMovies()
				} catch (error) {
					showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + error.message, 'error')
				}
			}

			function renderMovies() {
				const container = document.getElementById('movies-container')

				if (movies.length === 0) {
					container.innerHTML = '<div class="loading">–§–∏–ª—å–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>'
					return
				}

				container.innerHTML = movies
					.map(
						movie => `
                <div class="movie-card">
                    <div class="movie-poster">
                        üé¨
                    </div>
                    <div class="movie-info">
                        <div class="movie-title">${movie.title} (${
							movie.year
						})</div>
                        <div class="movie-meta">
                            <span>${movie.genre}</span>
                            ${
															movie.rating
																? `<span class="movie-rating">‚≠ê ${movie.rating}</span>`
																: '<span>–ë–µ–∑ —Ä–µ–π—Ç–∏–Ω–≥–∞</span>'
														}
                        </div>
                        <div class="status-badge status-${movie.status}">
                            ${
															movie.status === 'watched'
																? '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ'
																: '–ö –ø—Ä–æ—Å–º–æ—Ç—Ä—É'
														}
                        </div>
                        ${
													movie.description
														? `<div class="movie-description">${movie.description}</div>`
														: ''
												}
                        ${
													movie.director
														? `<div style="color: #ccc; font-size: 0.9em; margin-bottom: 10px;">–†–µ–∂. ${movie.director}</div>`
														: ''
												}
                        <div class="movie-actions">
                            <button class="btn btn-primary toggle-status-btn" data-id="${
															movie.id
														}">
                                ${
																	movie.status === 'watched'
																		? '‚ùå –ù–µ —Å–º–æ—Ç—Ä–µ–ª'
																		: '‚úÖ –ü–æ—Å–º–æ—Ç—Ä–µ–ª'
																}
                            </button>
                            <button class="btn btn-danger delete-btn" data-id="${
															movie.id
														}">
                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            `
					)
					.join('')

				// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
				document.querySelectorAll('.toggle-status-btn').forEach(btn => {
					btn.addEventListener('click', e => {
						const movieId = parseInt(e.target.dataset.id)
						toggleWatchStatus(movieId)
					})
				})

				document.querySelectorAll('.delete-btn').forEach(btn => {
					btn.addEventListener('click', e => {
						const movieId = parseInt(e.target.dataset.id)
						deleteMovie(movieId)
					})
				})
			}

			function showMessage(text, type) {
				const messageDiv = document.getElementById('message')
				messageDiv.innerHTML = `
                <div class="message ${type}">
                    ${text}
                </div>
            `

				setTimeout(() => {
					messageDiv.innerHTML = ''
				}, 4000)
			}
		</script>
	</body>
</html>
