<!DOCTYPE html>
<html>
	<head>
		<title>–¢–∞–π–º–µ—Ä –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				text-align: center;
				background: #f5f5f5;
				padding: 20px;
				max-width: 600px;
				margin: 0 auto;
			}
			.timer {
				font-size: 48px;
				margin: 20px;
				color: #333;
				background: white;
				padding: 20px;
				border-radius: 10px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			}
			.controls {
				background: white;
				padding: 20px;
				border-radius: 10px;
				margin: 20px 0;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			}
			.time-inputs {
				display: flex;
				justify-content: center;
				gap: 20px;
				margin: 15px 0;
			}
			.time-input {
				display: flex;
				flex-direction: column;
				align-items: center;
			}
			input {
				padding: 10px;
				font-size: 16px;
				width: 80px;
				text-align: center;
				border: 2px solid #ddd;
				border-radius: 5px;
				margin: 5px 0;
			}
			button {
				padding: 12px 24px;
				margin: 5px;
				font-size: 16px;
				cursor: pointer;
				border: none;
				border-radius: 5px;
				background: #4caf50;
				color: white;
				transition: background 0.3s;
			}
			button:hover {
				background: #45a049;
			}
			button:disabled {
				background: #cccccc;
				cursor: not-allowed;
			}
			.stats {
				display: flex;
				justify-content: space-around;
				margin: 20px;
				background: white;
				padding: 15px;
				border-radius: 10px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			}
			.mode-indicator {
				font-size: 24px;
				margin: 10px 0;
				padding: 10px;
				border-radius: 5px;
			}
			.work-mode {
				background: #ffebee;
				color: #d32f2f;
			}
			.break-mode {
				background: #e8f5e8;
				color: #388e3c;
			}
			#history {
				background: white;
				padding: 20px;
				border-radius: 10px;
				margin-top: 20px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
				text-align: left;
			}
			.session-item {
				padding: 8px;
				margin: 5px 0;
				border-left: 4px solid #4caf50;
				background: #f9f9f9;
			}
		</style>
	</head>
	<body>
		<h1>‚è∞ –¢–∞–π–º–µ—Ä –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h1>

		<div class="mode-indicator" id="modeIndicator">üíº –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</div>

		<div class="timer" id="timer">25:00</div>

		<div class="controls">
			<div class="time-inputs">
				<div class="time-input">
					<label>–†–∞–±–æ—Ç–∞ (–º–∏–Ω—É—Ç—ã):</label>
					<input type="number" id="workTime" value="25" min="1" max="120" />
				</div>
				<div class="time-input">
					<label>–û—Ç–¥—ã—Ö (–º–∏–Ω—É—Ç—ã):</label>
					<input type="number" id="breakTime" value="5" min="1" max="60" />
				</div>
			</div>

			<div>
				<button onclick="applySettings()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
				<button onclick="startTimer()" id="startBtn">–°—Ç–∞—Ä—Ç</button>
				<button onclick="pauseTimer()" id="pauseBtn">–ü–∞—É–∑–∞</button>
				<button onclick="resetTimer()">–°–±—Ä–æ—Å</button>
			</div>
		</div>

		<div class="stats">
			<div>–°–µ–≥–æ–¥–Ω—è: <span id="todaySessions">0</span> —Å–µ—Å—Å–∏–π</div>
			<div>–í—Å–µ–≥–æ: <span id="totalSessions">0</span> —Å–µ—Å—Å–∏–π</div>
		</div>

		<div id="history"></div>

		<script>
			const defaultStats = {
				sessions: [],
				totalSessions: 0,
				todaySessions: 0,
			}

			let timer
			let timeLeft = 25 * 60
			let isRunning = false
			let isWorkTime = true
			let workDuration = 25
			let breakDuration = 5

			function loadStats() {
				return new Promise(resolve => {
					try {
						const stats =
							JSON.parse(localStorage.getItem('productivityStats')) ||
							defaultStats
						resolve(stats)
					} catch (error) {
						console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error)
						resolve(defaultStats)
					}
				})
			}

			async function saveStats(stats) {
				return new Promise((resolve, reject) => {
					try {
						const today = new Date().toDateString()
						stats.todaySessions = stats.sessions.filter(
							session => new Date(session.date).toDateString() === today
						).length

						localStorage.setItem('productivityStats', JSON.stringify(stats))
						resolve()
					} catch (error) {
						reject(error)
					}
				})
			}

			function applySettings() {
				const workInput = document.getElementById('workTime')
				const breakInput = document.getElementById('breakTime')

				workDuration = parseInt(workInput.value) || 25
				breakDuration = parseInt(breakInput.value) || 5

				if (workDuration < 1) workDuration = 1
				if (workDuration > 120) workDuration = 120
				if (breakDuration < 1) breakDuration = 1
				if (breakDuration > 60) breakDuration = 60

				workInput.value = workDuration
				breakInput.value = breakDuration

				if (!isRunning) {
					timeLeft = (isWorkTime ? workDuration : breakDuration) * 60
					updateTimerDisplay()
				}

				alert(
					`–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã!\n–†–∞–±–æ—Ç–∞: ${workDuration} –º–∏–Ω\n–û—Ç–¥—ã—Ö: ${breakDuration} –º–∏–Ω`
				)
			}

			function updateTimerDisplay() {
				const minutes = Math.floor(timeLeft / 60)
				const seconds = timeLeft % 60
				document.getElementById('timer').textContent = `${minutes
					.toString()
					.padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`
			}

			function updateModeIndicator() {
				const indicator = document.getElementById('modeIndicator')
				if (isWorkTime) {
					indicator.textContent = 'üíº –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã'
					indicator.className = 'mode-indicator work-mode'
				} else {
					indicator.textContent = '‚òï –†–µ–∂–∏–º –æ—Ç–¥—ã—Ö–∞'
					indicator.className = 'mode-indicator break-mode'
				}
			}

			function startTimer() {
				if (isRunning) return

				isRunning = true
				document.getElementById('startBtn').disabled = true
				document.getElementById('pauseBtn').disabled = false

				timer = setInterval(async () => {
					timeLeft--
					updateTimerDisplay()

					if (timeLeft <= 0) {
						await completeSession()
					}
				}, 1000)
			}

			async function completeSession() {
				clearInterval(timer)
				isRunning = false
				document.getElementById('startBtn').disabled = false
				document.getElementById('pauseBtn').disabled = true

				const stats = await loadStats()
				const sessionType = isWorkTime ? 'work' : 'break'
				const sessionDuration = isWorkTime ? workDuration : breakDuration

				stats.sessions.push({
					id: Date.now(),
					date: new Date().toISOString(),
					type: sessionType,
					duration: sessionDuration,
				})
				stats.totalSessions = stats.sessions.length

				await saveStats(stats)
				await updateDisplay()

				isWorkTime = !isWorkTime
				timeLeft = (isWorkTime ? workDuration : breakDuration) * 60

				updateTimerDisplay()
				updateModeIndicator()

				if (isWorkTime) {
					alert('üíº –í—Ä–µ–º—è —Ä–∞–±–æ—Ç–∞—Ç—å!')
				} else {
					alert('‚òï –í—Ä–µ–º—è –æ—Ç–¥–æ—Ö–Ω—É—Ç—å!')
				}

				startTimer()
			}

			function pauseTimer() {
				if (!isRunning) return

				clearInterval(timer)
				isRunning = false
				document.getElementById('startBtn').disabled = false
				document.getElementById('pauseBtn').disabled = true
			}

			function resetTimer() {
				clearInterval(timer)
				isRunning = false
				document.getElementById('startBtn').disabled = false
				document.getElementById('pauseBtn').disabled = true

				timeLeft = (isWorkTime ? workDuration : breakDuration) * 60
				updateTimerDisplay()
			}

			async function updateDisplay() {
				const stats = await loadStats()

				document.getElementById('todaySessions').textContent =
					stats.todaySessions
				document.getElementById('totalSessions').textContent =
					stats.totalSessions

				const historyElement = document.getElementById('history')
				const recentSessions = stats.sessions.slice(-10).reverse()

				historyElement.innerHTML =
					'<h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–µ—Å—Å–∏–∏:</h3>' +
					(recentSessions.length > 0
						? recentSessions
								.map(
									session =>
										`<div class="session-item">
                            ${new Date(session.date).toLocaleString()} - 
                            ${
															session.type === 'work' ? 'üíº –†–∞–±–æ—Ç–∞' : '‚òï –û—Ç–¥—ã—Ö'
														} 
                            (${session.duration} –º–∏–Ω)
                        </div>`
								)
								.join('')
						: '<div>–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π</div>')
			}

			async function init() {
				await updateDisplay()
				updateTimerDisplay()
				updateModeIndicator()
			}

			document
				.getElementById('workTime')
				.addEventListener('change', function () {
					let value = parseInt(this.value)
					if (value < 1) this.value = 1
					if (value > 120) this.value = 120
				})

			document
				.getElementById('breakTime')
				.addEventListener('change', function () {
					let value = parseInt(this.value)
					if (value < 1) this.value = 1
					if (value > 60) this.value = 60
				})

			init()
		</script>
	</body>
</html>
